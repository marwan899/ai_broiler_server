<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© Ø¥Ø¯Ø§Ø±Ø© ÙØ±ÙˆØ¬ Ø§Ù„Ù„Ø­Ù… (Ross 308)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* (Styles remain the same) */
        body { font-family: 'Cairo', sans-serif; background-color: #f7f9fc; padding: 20px; }
        .container-fluid { max-width: 1400px; margin: 0 auto; background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); }
        table { width: 100%; border-collapse: collapse; margin-top: 1.5rem; }
        th, td { padding: 12px 15px; text-align: right; border-bottom: 1px solid #e2e8f0; vertical-align: top; }
        th { background-color: #3b82f6; color: white; font-weight: 700; text-align: center; }
        tbody tr:hover { background-color: #f0f4f8; }
        .data-card { background-color: #eff6ff; border-left: 5px solid #3b82f6; padding: 1rem; border-radius: 8px; }
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(0, 0, 0, 0.6); display: flex; align-items: center; justify-content: center; z-index: 50; }
        .modal-content { background: white; padding: 2rem; border-radius: 12px; max-width: 600px; width: 90%; max-height: 90vh; overflow-y: auto; }
        .form-input { width: 100%; padding: 0.65rem; border-radius: 8px; border: 1px solid #d1d5db; text-align: right; font-size: 1rem; background-color: #f9fafb; }
    </style>
</head>
<body>

    <div class="container-fluid">
        <h1 class="text-3xl font-bold text-gray-800 border-b pb-3 mb-4">Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ© (Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù‚Ø·ÙŠØ¹)</h1>
        
        <div class="mb-6">
            <label for="breeder-search" class="block text-gray-700 font-semibold mb-2">Ø§Ù„Ø¨Ø­Ø«/Ø§Ù„ØªØµÙÙŠØ© Ø¨Ø§Ø³Ù… Ø§Ù„Ù…Ø±Ø¨ÙŠ:</label>
            <input type="text" id="breeder-search" class="form-input w-full p-2 border-2 border-blue-300 rounded-lg text-right" placeholder="Ø§Ø¨Ø­Ø« Ø¨ÙƒØªØ§Ø¨Ø© Ø§Ø³Ù… Ø§Ù„Ù…Ø±Ø¨ÙŠ Ù‡Ù†Ø§..." onkeyup="filterTable()">
        </div>
        
        <p id="status-message" class="text-lg font-semibold text-blue-600 mb-4">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù…...</p>

        <h2 id="current-flock-title" class="text-2xl font-semibold text-gray-700 mt-8 mb-4">Ù…Ù„Ø®Øµ Ø§Ù„Ù‚Ø·Ø¹Ø§Ù† Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ (Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„)</h2>
        <div id="flock-details" class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-4 mb-6">
            </div>

        <h2 class="text-2xl font-semibold text-gray-700 mt-8 mb-4">Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ© Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ©</h2>
        <div class="overflow-x-auto">
            <table id="records-table" class="min-w-full">
                <thead>
                    <tr>
                        <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th> 
                        <th>ÙˆÙ‚Øª Ø§Ù„ØªØ³Ø¬ÙŠÙ„/Ø§Ù„ØªØ¹Ø¯ÙŠÙ„</th> 
                        <th class="rounded-tr-lg">Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
                        <th>Ø§Ù„ÙˆØ²Ù† (ØºØ±Ø§Ù…)</th>
                        <th>Ø§Ù„Ù†Ø§ÙÙ‚</th>
                        <th>Ø§Ù„Ù…Ø§Ø¡ (Ù„ØªØ±)</th> 
                        <th>Ø§Ù„Ø¹Ù„Ù (ÙƒØ¬Ù…)</th>
                        <th><a href="#" onclick="loadAdminDashboard(null)" class="text-white hover:text-gray-200">Ø§Ù„Ù…Ø±Ø¨ÙŠ (Ù„Ù„ØªØµÙÙŠØ© Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø³Ù…)</a></th> 
                        <th class="rounded-tl-lg">Ø§Ù„ÙŠÙˆÙ…</th>
                    </tr>
                </thead>
                <tbody id="records-table-body">
                    </tbody>
            </table>
        </div>
        
    </div>

    <div id="edit-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">ØªØ¹Ø¯ÙŠÙ„ Ø³Ø¬Ù„ Ø§Ù„ÙŠÙˆÙ… <span id="edit-day-display" class="text-blue-600"></span></h2>
            <p class="text-gray-600 mb-4">Ø§Ù„Ù‚Ø·ÙŠØ¹: <span id="edit-flock-id-display" class="font-semibold"></span> | Ø§Ù„Ù…Ø±Ø¨ÙŠ: <span id="edit-breeder-name-display" class="font-semibold"></span></p>

            <form id="edit-form" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <input type="hidden" id="edit-flock-id">
                <input type="hidden" id="edit-day">
                <input type="hidden" id="edit-breeder-name-hidden">

                <div>
                    <label for="edit-feed" class="block text-gray-700 font-semibold mb-2">Ø§Ù„Ø¹Ù„Ù Ø§Ù„Ù…Ø³ØªÙ‡Ù„Ùƒ (ÙƒØºÙ…)</label>
                    <input type="number" step="0.1" id="edit-feed" class="form-input" required>
                </div>
                <div>
                    <label for="edit-mortality" class="block text-gray-700 font-semibold mb-2">Ø¹Ø¯Ø¯ Ø§Ù„Ù†Ø§ÙÙ‚ Ø§Ù„ÙŠÙˆÙ…</label>
                    <input type="number" id="edit-mortality" class="form-input" required>
                </div>
                <div>
                    <label for="edit-water" class="block text-gray-700 font-semibold mb-2">Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ø§Ù„Ù…Ø§Ø¡ Ø§Ù„ÙŠÙˆÙ…ÙŠ (Ù„ØªØ±)</label>
                    <input type="number" step="1" id="edit-water" class="form-input" required>
                </div>
                <div>
                    <label for="edit-weight" class="block text-gray-700 font-semibold mb-2">Ù…ØªÙˆØ³Ø· ÙˆØ²Ù† Ø§Ù„Ø·Ø§Ø¦Ø± (ØºØ±Ø§Ù…)</label>
                    <input type="number" id="edit-weight" class="form-input">
                </div>
                
                <div class="md:col-span-2">
                    <label for="edit-notes" class="block text-gray-700 font-semibold mb-2">Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª/Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</label>
                    <textarea id="edit-notes" rows="3" class="form-input"></textarea>
                </div>

                <div class="flex justify-end gap-4 mt-6 md:col-span-2">
                    <button type="button" onclick="closeEditModal()" class="btn bg-gray-500 hover:bg-gray-600 text-white">Ø¥Ù„ØºØ§Ø¡</button>
                    <button type="submit" class="btn bg-green-600 hover:bg-green-700 text-white">Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª</button>
                </div>
            </form>
        </div>
    </div>


<script>
    const SERVER_URL = ''; // ØªÙ… ØªØ¹Ø¯ÙŠÙ„Ù‡ Ù„Ù„Ø¹Ù…Ù„ Ù…Ø¹ Vercel Ø§Ù„Ù†Ø³Ø¨ÙŠ
    
    const statusMessage = document.getElementById('status-message');
    const flockDetailsDiv = document.getElementById('flock-details');
    const recordsTableBody = document.getElementById('records-table-body');
    const currentFlockTitle = document.getElementById('current-flock-title');
    const editModal = document.getElementById('edit-modal');
    const editForm = document.getElementById('edit-form');

    // Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª
    function formatDateTime(isoString) {
        if (!isoString) return 'ØºÙŠØ± Ù…Ø³Ø¬Ù„';
        const date = new Date(isoString);
        return date.toLocaleDateString('ar-IQ', { year: 'numeric', month: 'short', day: 'numeric' }) + 
               ' @ ' + 
               date.toLocaleTimeString('ar-IQ', { hour: '2-digit', minute: '2-digit', hour12: true });
    }
    
    // --- Ø¯ÙˆØ§Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© (PUT Ùˆ DELETE) ---
    window.deleteRecord = async (flockId, day) => {
        if (!confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø³Ø¬Ù„ Ø§Ù„ÙŠÙˆÙ… ${day} Ù…Ù† Ø§Ù„Ù‚Ø·ÙŠØ¹ ${flockId}ØŸ Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡.`)) {
            return;
        }
        
        try {
            // ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø³Ø§Ø± Ù‡Ù†Ø§
            const response = await fetch(`/api/records/delete`, { 
                method: 'DELETE',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ flockId, day })
            });
            
            const result = await response.json();

            if (!response.ok) {
                throw new Error(result.message || `ÙØ´Ù„ Ø§Ù„Ø­Ø°Ù Ù„Ù„ÙŠÙˆÙ… ${day}.`);
            }

            alert(result.message);
            loadAdminDashboard(null); 
            
        } catch (error) {
            alert(`Ø®Ø·Ø£: ${error.message}`);
            console.error('Delete Error:', error);
        }
    }

    // --- Ø¯Ø§Ù„Ø© ÙØªØ­ Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ (Ù…Ø¹Ø¯Ù„) ---
    window.openEditModal = (record) => {
        document.getElementById('edit-day-display').textContent = record.day;
        document.getElementById('edit-flock-id-display').textContent = record.flockId;
        document.getElementById('edit-breeder-name-display').textContent = record.breederName;
        
        document.getElementById('edit-flock-id').value = record.flockId;
        document.getElementById('edit-day').value = record.day;
        document.getElementById('edit-breeder-name-hidden').value = record.breederName; // Ù„Ø­ÙØ¸ Ø§Ù„Ø§Ø³Ù…
        document.getElementById('edit-feed').value = record.feedKg || 0;
        document.getElementById('edit-mortality').value = record.mortality || 0;
        document.getElementById('edit-water').value = record.waterIntake || 0;
        document.getElementById('edit-weight').value = record.avgWeight || ''; 
        document.getElementById('edit-notes').value = record.notes || '';
        
        editModal.classList.remove('hidden');
    }

    // --- Ø¯Ø§Ù„Ø© Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ ---
    window.closeEditModal = () => {
        editModal.classList.add('hidden');
    }

    // --- Ù…Ø¹Ø§Ù„Ø¬ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ (PUT) ---
    editForm.addEventListener('submit', async (e) => {
        e.preventDefault();

        const updatedData = {
            flockId: document.getElementById('edit-flock-id').value,
            day: parseInt(document.getElementById('edit-day').value),
            breederName: document.getElementById('edit-breeder-name-hidden').value, 
            avgWeight: document.getElementById('edit-weight').value === '' ? null : parseFloat(document.getElementById('edit-weight').value),
            mortality: parseInt(document.getElementById('edit-mortality').value) || 0,
            feedKg: parseFloat(document.getElementById('edit-feed').value) || 0,
            waterIntake: parseFloat(document.getElementById('edit-water').value) || 0, // <--- Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ø§Ø¡
            notes: document.getElementById('edit-notes').value.trim()
        };

        try {
            // ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø³Ø§Ø± Ù‡Ù†Ø§
            const response = await fetch(`/api/records/update`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(updatedData)
            });
            
            const result = await response.json();

            if (!response.ok) {
                throw new Error(result.message || `ÙØ´Ù„ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù„Ù„ÙŠÙˆÙ… ${updatedData.day}.`);
            }
            
            alert(`âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø³Ø¬Ù„ Ø§Ù„ÙŠÙˆÙ… ${updatedData.day} Ø¨Ù†Ø¬Ø§Ø­.`);
            closeEditModal();
            loadAdminDashboard(null); 
            
        } catch (error) {
            alert(`Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„: ${error.message}`);
            console.error('Update Error:', error);
        }
    });

    // --- Ø¯Ø§Ù„Ø© Ù„Ø¬Ù„Ø¨ ÙˆØ¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ù…Ø¹Ø¯Ù„Ø© Ù„Ù„ØªØµÙÙŠØ©) ---
    window.loadAdminDashboard = async (filterBreederName = null) => {
        statusMessage.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…...';
        recordsTableBody.innerHTML = '';
        flockDetailsDiv.innerHTML = '';

        try {
            // ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø³Ø§Ø± Ù‡Ù†Ø§
            const response = await fetch(`/api/flock/all-data`);
            if (!response.ok) {
                throw new Error(`ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ${response.status} ${response.statusText}`);
            }

            const allFlockData = await response.json();
            
            let flocksToDisplay;

            if (filterBreederName) {
                flocksToDisplay = allFlockData.filter(f => f.breederName && f.breederName.toUpperCase() === filterBreederName.toUpperCase());
                currentFlockTitle.textContent = `Ù…Ù„Ø®Øµ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±Ø¨ÙŠ: ${filterBreederName}`;
            } else {
                flocksToDisplay = allFlockData;
                currentFlockTitle.textContent = `Ù…Ù„Ø®Øµ Ø§Ù„Ù‚Ø·Ø¹Ø§Ù† Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ (Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„)`;
            }

            if (flocksToDisplay.length === 0) {
                statusMessage.className = 'text-lg font-semibold text-orange-600 mb-4';
                statusMessage.textContent = filterBreederName ? `Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø³Ø¬Ù„Ø© Ù„Ù„Ù…Ø±Ø¨ÙŠ: ${filterBreederName}.` : 'âœ… Ø§Ù„Ø®Ø§Ø¯Ù… ÙŠØ¹Ù…Ù„ØŒ ÙˆÙ„ÙƒÙ† Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª Ø¨Ø¹Ø¯.';
                return;
            }

            let allRecords = [];
            flocksToDisplay.forEach(flock => {
                 if (flock.dailyRecords) {
                    allRecords = allRecords.concat(flock.dailyRecords.map(record => ({
                        ...record,
                        initialChickCount: flock.initialChickCount,
                        flockId: flock.flockId // ØªØ£ÙƒÙŠØ¯ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù€ ID Ù„Ù„Ø­Ø°Ù ÙˆØ§Ù„ØªØ¹Ø¯ÙŠÙ„
                    })));
                 }
            });
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù„Ù„Ù…Ù„Ø®Øµ
            const totalInitialCount = flocksToDisplay.reduce((sum, f) => sum + (f.initialChickCount || 0), 0);
            const totalMortality = allRecords.reduce((sum, r) => sum + (r.mortality || 0), 0);
            const totalFeed = allRecords.reduce((sum, r) => sum + (r.feedKg || 0), 0);
            const currentTotalCount = totalInitialCount - totalMortality;

            // Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù‚Ø·ÙŠØ¹ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© (Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ)
            flockDetailsDiv.innerHTML = `
                <div class="data-card lg:col-span-2 bg-indigo-50 border-indigo-600">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø±Ø¨ÙŠÙ†: <span class="font-bold text-indigo-700">${flocksToDisplay.length}</span></div>
                <div class="data-card bg-green-50 border-green-600">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙˆÙ„ÙŠ: <span class="font-bold text-green-700">${totalInitialCount.toLocaleString('ar-IQ')}</span></div>
                <div class="data-card">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·ÙŠÙˆØ± Ø§Ù„Ø­Ø§Ù„ÙŠ: <span class="font-bold text-green-700">${currentTotalCount.toLocaleString('ar-IQ')}</span></div>
                <div class="data-card">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†ÙÙˆÙ‚: <span class="font-bold text-red-600">${totalMortality.toLocaleString('ar-IQ')}</span></div>
                <div class="data-card lg:col-span-2">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ù„Ù Ø§Ù„Ù…Ø³ØªÙ‡Ù„Ùƒ (ÙƒØ¬Ù…): <span class="font-bold">${totalFeed.toFixed(2)}</span></div>
            `;

            // 4. Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¬Ù„Ø§Øª ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„
            const sortedRecords = [...allRecords].sort((a, b) => {
                if (a.breederName !== b.breederName) {
                    return a.breederName.localeCompare(b.breederName);
                }
                return b.day - a.day;
            });

            sortedRecords.forEach(record => {
                const row = recordsTableBody.insertRow();
                const recordJsonString = JSON.stringify(record).replace(/"/g, '&quot;'); 
                
                const displayDateTime = formatDateTime(record.updatedAt || record.createdAt);

                row.innerHTML = `
                    <td>
                        <button onclick='openEditModal(${recordJsonString})' class="text-xs bg-yellow-500 hover:bg-yellow-600 text-white p-1 rounded-md">ØªØ¹Ø¯ÙŠÙ„</button>
                        <button onclick="deleteRecord('${record.flockId}', ${record.day})" class="text-xs bg-red-500 hover:bg-red-600 text-white p-1 rounded-md mt-1">Ø­Ø°Ù</button>
                    </td>
                    <td class="text-sm">${displayDateTime}</td>
                    <td class="text-sm w-40">${record.notes || 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„Ø§Ø­Ø¸Ø§Øª'}</td>
                    <td class="text-center">${record.avgWeight !== null ? record.avgWeight : '--'}</td>
                    <td class="text-center text-red-600 font-semibold">${record.mortality || 0}</td>
                    <td class="text-center text-blue-600 font-semibold">${record.waterIntake !== null ? record.waterIntake : '--'}</td>
                    <td class="text-center">${record.feedKg !== null ? record.feedKg.toFixed(2) : '--'}</td>
                    <td class="text-center font-bold text-indigo-700">
                        <a href="#" onclick="loadAdminDashboard('${record.breederName}')" class="hover:underline">
                            ${record.breederName || 'N/A'}
                        </a>
                    </td> 
                    <td class="text-center font-bold text-blue-700">${record.day}</td>
                `;
            });

            statusMessage.className = 'text-lg font-semibold text-green-600 mb-4';
            statusMessage.textContent = `âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­. Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø³Ø¬Ù„Ø§Øª: ${allRecords.length}.`;

        } catch (error) {
            console.error("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…:", error);
            statusMessage.className = 'text-lg font-semibold text-red-600 mb-4';
            statusMessage.textContent = `ğŸ›‘ ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…: ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ø®Ø§Ø¯Ù… ÙŠØ¹Ù…Ù„ ÙˆÙ…ØªØ§Ø­ Ø¹Ø¨Ø± HTTPS. (${error.message})`;
        }
    }

    // --- Ø¯Ø§Ù„Ø© Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ØªØµÙÙŠØ© (Ø¹Ù„Ù‰ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø­Ø§Ù„ÙŠ) ---
    window.filterTable = () => {
        const input = document.getElementById('breeder-search');
        const filter = input.value.toUpperCase();
        const tr = recordsTableBody.getElementsByTagName('tr');
        const breederColumnIndex = 7; 

        for (let i = 0; i < tr.length; i++) {
            const td = tr[i].getElementsByTagName('td')[breederColumnIndex];
            if (td) {
                const txtValue = td.textContent || td.innerText;
                if (txtValue.toUpperCase().indexOf(filter) > -1) {
                    tr[i].style.display = "";
                } else {
                    tr[i].style.display = "none";
                }
            }       
        }
    }

    // ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¯Ø§Ù„Ø© Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
    loadAdminDashboard(null);
</script>
</body>
</html>
